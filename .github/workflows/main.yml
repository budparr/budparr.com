name: Deploy to Cloudflare
on: repository_dispatch
# on:
#   push:
#     branches:
#       - master

jobs:
  if: github.event.action == 'build_eleventy'
    deploy:
      runs-on: ubuntu-latest
      name: Deploy
      steps:
        - uses: actions/checkout@master
        - name: Use Node.js 12.x          
          uses: actions/setup-node@v1
          with:
            node-version: 12.x        
        - name: yarn install, build
          # if: github.event.action == 'build_eleventy'
          run: |
            echo "Hello From my_custom_webhook_2...doing XYZ"
            yarn install
            yarn build      
          env:
            PUBLISH_DIR: dist 
            PUBLISH_BRANCH: master
            GHOST_API_URL: ${{ secrets.GHOST_API_URL }}
            GHOST_CONTENT_API_KEY: ${{ secrets.GHOST_CONTENT_API_KEY }}
            SITE_URL: ${{ secrets.SITE_URL }}
        - name: Publish
          uses: cloudflare/wrangler-action@1.1.0
          with:
            apiToken: ${{ secrets.CF_API_TOKEN }}
            environment: 'production'
